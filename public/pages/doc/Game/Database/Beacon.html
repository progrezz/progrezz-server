<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Game::Database::Beacon
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!Game/Database/Beacon.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (B)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Game.html" title="Game (module)">Game</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Database.html" title="Game::Database (module)">Database</a></span></span>
     &raquo; 
    <span class="title">Beacon</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Game::Database::Beacon
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="ItemGeolocatedObject.html" title="Game::Database::ItemGeolocatedObject (class)">ItemGeolocatedObject</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next"><span class='object_link'><a href="GeolocatedObject.html" title="Game::Database::GeolocatedObject (class)">GeolocatedObject</a></span></li>
          
            <li class="next"><span class='object_link'><a href="ItemGeolocatedObject.html" title="Game::Database::ItemGeolocatedObject (class)">ItemGeolocatedObject</a></span></li>
          
            <li class="next">Game::Database::Beacon</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2">Neo4j::ActiveNode</dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">rb/db/objects/beacon.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Clase que representa una baliza (beacon) geolocalizado.</p>


  </div>
</div>
<div class="tags">
  

</div>
  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="DEFAULT_MESSAGE-constant" class="">DEFAULT_MESSAGE =
          <div class="docstring">
  <div class="discussion">
    
<p>Mensaje por defecto.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Progrezz&#39;s beacon.</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
        <dt id="RELATED_ITEM-constant" class="">RELATED_ITEM =
          <div class="docstring">
  <div class="discussion">
    
<p>Identificador del objeto geolocalizado.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>geo_beacon</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
        <dt id="MESSAGE_MIN_LENGHT-constant" class="">MESSAGE_MIN_LENGHT =
          <div class="docstring">
  <div class="discussion">
    
<p>Tamaño mínimo del mensaje.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>5</span></pre></dd>
      
        <dt id="MESSAGE_MAX_LENGHT-constant" class="">MESSAGE_MAX_LENGHT =
          <div class="docstring">
  <div class="discussion">
    
<p>Tamaño máximo del mensaje.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>255</span></pre></dd>
      
    </dl>
  



  
  
  <h3 class="inherited">Constants inherited
     from <span class='object_link'><a href="ItemGeolocatedObject.html" title="Game::Database::ItemGeolocatedObject (class)">ItemGeolocatedObject</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="ItemGeolocatedObject.html#DEFAULT_DURATION-constant" title="Game::Database::ItemGeolocatedObject::DEFAULT_DURATION (constant)">ItemGeolocatedObject::DEFAULT_DURATION</a></span></p>

  
  
  <h3 class="inherited">Constants inherited
     from <span class='object_link'><a href="GeolocatedObject.html" title="Game::Database::GeolocatedObject (class)">GeolocatedObject</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="GeolocatedObject.html#MAX_LATITUDE-constant" title="Game::Database::GeolocatedObject::MAX_LATITUDE (constant)">GeolocatedObject::MAX_LATITUDE</a></span>, <span class='object_link'><a href="GeolocatedObject.html#MAX_LONGITUDE-constant" title="Game::Database::GeolocatedObject::MAX_LONGITUDE (constant)">GeolocatedObject::MAX_LONGITUDE</a></span>, <span class='object_link'><a href="GeolocatedObject.html#MIN_LATITUDE-constant" title="Game::Database::GeolocatedObject::MIN_LATITUDE (constant)">GeolocatedObject::MIN_LATITUDE</a></span>, <span class='object_link'><a href="GeolocatedObject.html#MIN_LONGITUDE-constant" title="Game::Database::GeolocatedObject::MIN_LONGITUDE (constant)">GeolocatedObject::MIN_LONGITUDE</a></span></p>




  <h2>Instance Attribute Summary</h2>
  
  <h3 class="inherited">Attributes inherited from <span class='object_link'><a href="GeolocatedObject.html" title="Game::Database::GeolocatedObject (class)">GeolocatedObject</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="GeolocatedObject.html#is_updating-instance_method" title="Game::Database::GeolocatedObject#is_updating (method)">#is_updating</a></span></p>


  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_item-class_method" title="create_item (class method)">+ (Game::Database::Beacon) <strong>create_item</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Crear un objeto.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_beacon-class_method" title="get_beacon (class method)">+ (Game::Database::Beacon<sup>?</sup>) <strong>get_beacon</strong>(uuid) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Retornar baliza dada una uuid.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_item-class_method" title="get_item (class method)">+ (Game::Database::Item) <strong>get_item</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Getter del objeto de la baliza (inventario).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#search_by_radius-class_method" title="search_by_radius (class method)">+ (Array) <strong>search_by_radius</strong>(geolocation, radius) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Buscar balizas cercanas en un determinado radio de busqueda (circula),
especificado en <code>km</code>.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#action_radius-instance_method" title="#action_radius (instance method)">- (Float) <strong>action_radius</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Radio de acción de la baliza, en km.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_life_time-instance_method" title="#add_life_time (instance method)">- (Float) <strong>add_life_time</strong>(time) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Añadir tiempo de vida a la baliza.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#both-instance_method" title="#both (instance method)">- (Game::Database::Beacon) <strong>both</strong>(:connected_beacons) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Relación con otras balizas (triangulizables).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#check_neighbours-instance_method" title="#check_neighbours (instance method)">- (Object) <strong>check_neighbours</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Comprobar estado de vecinos.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#disconnect-instance_method" title="#disconnect (instance method)">- (Object) <strong>disconnect</strong>(beacon) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Desconectarse de una baliza.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#dispatch-instance_method" title="#dispatch (instance method)">- (Object) <strong>dispatch</strong>(event_name, *args) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Lanzar un evento desde la baliza actual.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#energy_gained-instance_method" title="#energy_gained (instance method)">- (Integer) <strong>energy_gained</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Cantidad de energía que ha recibido la baliza.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#mark_as_removed-instance_method" title="#mark_as_removed (instance method)">- (Boolean) <strong>mark_as_removed</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Variable auxiliar para evitar bucles infinitos.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#max_connections-instance_method" title="#max_connections (instance method)">- (Integer) <strong>max_connections</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Máximo número de conexiones de esta baliza.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#message-instance_method" title="#message (instance method)">- (String) <strong>message</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Mensaje del usuario que ha dejado la baliza.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#out-instance_method" title="#out (instance method)">- (Game::Database::LevelProfile) <strong>out</strong>(:level_profile) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Relación con el nivel de la baliza (#Game::Database::LevelProfile).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remove-instance_method" title="#remove (instance method)">- (Object) <strong>remove</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Borrar baliza.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_hash-instance_method" title="#to_hash (instance method)">- (Hash&lt;Symbol, Object&gt;) <strong>to_hash</strong>(exclusion_list = [:owner]) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Transformar objeto a un hash.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_neighbours-instance_method" title="#update_neighbours (instance method)">- (Object) <strong>update_neighbours</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Actualizar conexiones con balizas cercanas.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#weight_per_deposit-instance_method" title="#weight_per_deposit (instance method)">- (Float) <strong>weight_per_deposit</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Peso (o probabilidad) Añadida a balizas cercanas.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="ItemGeolocatedObject.html" title="Game::Database::ItemGeolocatedObject (class)">ItemGeolocatedObject</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="ItemGeolocatedObject.html#caducated%3F-instance_method" title="Game::Database::ItemGeolocatedObject#caducated? (method)">#caducated?</a></span>, <span class='object_link'><a href="ItemGeolocatedObject.html#clear_caducated-class_method" title="Game::Database::ItemGeolocatedObject.clear_caducated (method)">clear_caducated</a></span>, <span class='object_link'><a href="ItemGeolocatedObject.html#created_at-instance_method" title="Game::Database::ItemGeolocatedObject#created_at (method)">#created_at</a></span>, <span class='object_link'><a href="ItemGeolocatedObject.html#descendants-class_method" title="Game::Database::ItemGeolocatedObject.descendants (method)">descendants</a></span>, <span class='object_link'><a href="ItemGeolocatedObject.html#duration-instance_method" title="Game::Database::ItemGeolocatedObject#duration (method)">#duration</a></span>, <span class='object_link'><a href="ItemGeolocatedObject.html#link_owner-instance_method" title="Game::Database::ItemGeolocatedObject#link_owner (method)">#link_owner</a></span>, <span class='object_link'><a href="ItemGeolocatedObject.html#owner-instance_method" title="Game::Database::ItemGeolocatedObject#owner (method)">#owner</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../../Evented.html" title="Evented (module)">Evented</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../Evented.html#add_event_listener-instance_method" title="Evented#add_event_listener (method)">#add_event_listener</a></span>, <span class='object_link'><a href="../../Evented.html#dispatch_event-instance_method" title="Evented#dispatch_event (method)">#dispatch_event</a></span>, <span class='object_link'><a href="../../Evented.html#remove_event_listener-instance_method" title="Evented#remove_event_listener (method)">#remove_event_listener</a></span></p>

  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="GeolocatedObject.html" title="Game::Database::GeolocatedObject (class)">GeolocatedObject</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="GeolocatedObject.html#clamp-instance_method" title="Game::Database::GeolocatedObject#clamp (method)">#clamp</a></span>, <span class='object_link'><a href="GeolocatedObject.html#clamp%21-class_method" title="Game::Database::GeolocatedObject.clamp! (method)">clamp!</a></span>, <span class='object_link'><a href="GeolocatedObject.html#clamp_latitude-class_method" title="Game::Database::GeolocatedObject.clamp_latitude (method)">clamp_latitude</a></span>, <span class='object_link'><a href="GeolocatedObject.html#clamp_longitude-class_method" title="Game::Database::GeolocatedObject.clamp_longitude (method)">clamp_longitude</a></span>, <span class='object_link'><a href="GeolocatedObject.html#geolocation-instance_method" title="Game::Database::GeolocatedObject#geolocation (method)">#geolocation</a></span>, <span class='object_link'><a href="GeolocatedObject.html#latitude-instance_method" title="Game::Database::GeolocatedObject#latitude (method)">#latitude</a></span>, <span class='object_link'><a href="GeolocatedObject.html#longitude-instance_method" title="Game::Database::GeolocatedObject#longitude (method)">#longitude</a></span>, <span class='object_link'><a href="GeolocatedObject.html#set_geolocation-instance_method" title="Game::Database::GeolocatedObject#set_geolocation (method)">#set_geolocation</a></span>, <span class='object_link'><a href="GeolocatedObject.html#to_s-instance_method" title="Game::Database::GeolocatedObject#to_s (method)">#to_s</a></span></p>

  

  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="create_item-class_method">
  
    + (<tt><span class='object_link'><a href="" title="Game::Database::Beacon (class)">Game::Database::Beacon</a></span></tt>) <strong>create_item</strong>(*args) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Crear un objeto.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>args</span>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Array de argumentos. <a href="0">args</a> es el usuario que ha colocado el
objeto. <a href="1">args</a> es el hash de datos extra.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Game::Database::Beacon (class)">Game::Database::Beacon</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Objeto creado y asociado.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../GenericException.html" title="GenericException (class)">::GenericException</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rb/db/objects/beacon.rb', line 75</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_create_item'>create_item</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_user'>user</span>         <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_extra_params'>extra_params</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='op'>::</span><span class='const'>GenericException</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid user.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_user'>user</span> <span class='op'>==</span> <span class='kw'>nil</span>

  <span class='id identifier rubyid_params'>params</span> <span class='op'>=</span> <span class='const'>GenericUtils</span><span class='period'>.</span><span class='id identifier rubyid_default_params'>default_params</span><span class='lparen'>(</span> <span class='lbrace'>{</span>
    <span class='label'>message:</span> <span class='const'>DEFAULT_MESSAGE</span>
  <span class='rbrace'>}</span><span class='comma'>,</span> <span class='id identifier rubyid_extra_params'>extra_params</span> <span class='rparen'>)</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='op'>::</span><span class='const'>GenericException</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Message is too short ( less than </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='const'>MESSAGE_MIN_LENGHT</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>).</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:message</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&lt;</span> <span class='const'>MESSAGE_MIN_LENGHT</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='op'>::</span><span class='const'>GenericException</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Message is too long ( greather than </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='const'>MESSAGE_MAX_LENGHT</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>).</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:message</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='const'>MESSAGE_MAX_LENGHT</span>

  <span class='comment'># Crear baliza.
</span>  <span class='id identifier rubyid_beacon'>beacon</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span> <span class='label'>message:</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:message</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>duration:</span> <span class='const'>Game</span><span class='op'>::</span><span class='const'>Mechanics</span><span class='op'>::</span><span class='const'>BeaconMechanics</span><span class='period'>.</span><span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:base</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:duration</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span> <span class='rparen'>)</span>

  <span class='comment'># Asociar al usuario.
</span>  <span class='id identifier rubyid_beacon'>beacon</span><span class='period'>.</span><span class='id identifier rubyid_link_owner'>link_owner</span><span class='lparen'>(</span> <span class='id identifier rubyid_user'>user</span><span class='comma'>,</span> <span class='const'>RELATED_ITEM</span> <span class='rparen'>)</span>

  <span class='comment'># Crear nivel de baliza.
</span>  <span class='id identifier rubyid_beacon'>beacon</span><span class='period'>.</span><span class='id identifier rubyid_level_profile'>level_profile</span> <span class='op'>=</span> <span class='const'>Game</span><span class='op'>::</span><span class='const'>Database</span><span class='op'>::</span><span class='const'>LevelProfile</span><span class='period'>.</span><span class='id identifier rubyid_create_level_profile'>create_level_profile</span><span class='lparen'>(</span> <span class='rparen'>)</span>

  <span class='comment'># Ajustar geolocalización
</span>  <span class='id identifier rubyid_geo'>geo</span> <span class='op'>=</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_geolocation'>geolocation</span><span class='lparen'>(</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_beacon'>beacon</span><span class='period'>.</span><span class='id identifier rubyid_set_geolocation'>set_geolocation</span><span class='lparen'>(</span> <span class='id identifier rubyid_geo'>geo</span><span class='lbracket'>[</span><span class='symbol'>:latitude</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_geo'>geo</span><span class='lbracket'>[</span><span class='symbol'>:longitude</span><span class='rbracket'>]</span> <span class='rparen'>)</span>

  <span class='comment'># Lanzar evento de creación
</span>  <span class='id identifier rubyid_beacon'>beacon</span><span class='period'>.</span><span class='id identifier rubyid_dispatch'>dispatch</span><span class='lparen'>(</span><span class='symbol'>:OnCreate</span><span class='rparen'>)</span>

  <span class='comment'># Retornar baliza.
</span>  <span class='kw'>return</span> <span class='id identifier rubyid_beacon'>beacon</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_beacon-class_method">
  
    + (<tt><span class='object_link'><a href="" title="Game::Database::Beacon (class)">Game::Database::Beacon</a></span></tt><sup>?</sup>) <strong>get_beacon</strong>(uuid) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Retornar baliza dada una uuid.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>uuid</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Identificador de la base de datos.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Game::Database::Beacon (class)">Game::Database::Beacon</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Retorna la baliza si la encuentra. Si no, retornará nil.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


120
121
122
123
124
125
126
127
128
129</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rb/db/objects/beacon.rb', line 120</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_beacon'>get_beacon</span><span class='lparen'>(</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_beacon'>beacon</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>uuid:</span> <span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_beacon'>beacon</span><span class='period'>.</span><span class='id identifier rubyid_caducated?'>caducated?</span>
    <span class='id identifier rubyid_beacon'>beacon</span><span class='period'>.</span><span class='id identifier rubyid_remove'>remove</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_beacon'>beacon</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_beacon'>beacon</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_item-class_method">
  
    + (<tt><span class='object_link'><a href="Item.html" title="Game::Database::Item (class)">Game::Database::Item</a></span></tt>) <strong>get_item</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Getter del objeto de la baliza (inventario).</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Item.html" title="Game::Database::Item (class)">Game::Database::Item</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Referencia al objeto en la base de datos.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../GenericException.html" title="GenericException (class)">::GenericException</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


110
111
112
113
114
115</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rb/db/objects/beacon.rb', line 110</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_item'>get_item</span><span class='lparen'>(</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_item'>item</span> <span class='op'>=</span> <span class='const'>Game</span><span class='op'>::</span><span class='const'>Database</span><span class='op'>::</span><span class='const'>Item</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span> <span class='label'>item_id:</span> <span class='const'>RELATED_ITEM</span> <span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='op'>::</span><span class='const'>GenericException</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid beacon reference for item id &#39;</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='const'>RELATED_ITEM</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&#39;.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_item'>item</span> <span class='op'>==</span> <span class='kw'>nil</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_item'>item</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="search_by_radius-class_method">
  
    + (<tt>Array</tt>) <strong>search_by_radius</strong>(geolocation, radius) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Buscar balizas cercanas en un determinado radio de busqueda (circula),
especificado en <code>km</code>.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>geolocation</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Punto de búsqueda, de la forma <tt>{latitude: lat, longitude: lon}</tt></p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>radius</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Radio de busqueda, especificado en km.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Lista de Balizas cercanas.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rb/db/objects/beacon.rb', line 135</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_search_by_radius'>search_by_radius</span><span class='lparen'>(</span><span class='id identifier rubyid_geolocation'>geolocation</span><span class='comma'>,</span> <span class='id identifier rubyid_radius'>radius</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_lat'>lat</span> <span class='op'>=</span> <span class='const'>Progrezz</span><span class='op'>::</span><span class='const'>Geolocation</span><span class='period'>.</span><span class='id identifier rubyid_distance_to_latitude'>distance_to_latitude</span><span class='lparen'>(</span><span class='id identifier rubyid_radius'>radius</span><span class='comma'>,</span> <span class='symbol'>:km</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_lon'>lon</span> <span class='op'>=</span> <span class='const'>Progrezz</span><span class='op'>::</span><span class='const'>Geolocation</span><span class='period'>.</span><span class='id identifier rubyid_distance_to_longitude'>distance_to_longitude</span><span class='lparen'>(</span><span class='id identifier rubyid_radius'>radius</span><span class='comma'>,</span> <span class='symbol'>:km</span><span class='rparen'>)</span>

  <span class='comment'># Generar una lista de referencias
</span>  <span class='id identifier rubyid_beacons'>beacons</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_query_as'>query_as</span><span class='lparen'>(</span><span class='symbol'>:b</span><span class='rparen'>)</span>
   <span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>b.latitude  &gt; {l1} and b.latitude  &lt; {l2} and b.longitude &gt; {l3} and b.longitude &lt; {l4}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
   <span class='period'>.</span><span class='id identifier rubyid_params'>params</span><span class='lparen'>(</span>
      <span class='label'>l1:</span> <span class='lparen'>(</span><span class='id identifier rubyid_geolocation'>geolocation</span><span class='lbracket'>[</span><span class='symbol'>:latitude</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='id identifier rubyid_lat'>lat</span><span class='rparen'>)</span><span class='comma'>,</span>
      <span class='label'>l2:</span> <span class='lparen'>(</span><span class='id identifier rubyid_geolocation'>geolocation</span><span class='lbracket'>[</span><span class='symbol'>:latitude</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_lat'>lat</span><span class='rparen'>)</span><span class='comma'>,</span>
      <span class='label'>l3:</span> <span class='lparen'>(</span><span class='id identifier rubyid_geolocation'>geolocation</span><span class='lbracket'>[</span><span class='symbol'>:longitude</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='id identifier rubyid_lon'>lon</span><span class='rparen'>)</span><span class='comma'>,</span>
      <span class='label'>l4:</span> <span class='lparen'>(</span><span class='id identifier rubyid_geolocation'>geolocation</span><span class='lbracket'>[</span><span class='symbol'>:longitude</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_lon'>lon</span><span class='rparen'>)</span>
   <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_pluck'>pluck</span><span class='lparen'>(</span><span class='symbol'>:b</span><span class='rparen'>)</span>

  <span class='comment'># Convertir a una lista
</span>  <span class='id identifier rubyid_beacons'>beacons</span> <span class='op'>=</span> <span class='id identifier rubyid_beacons'>beacons</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>

  <span class='comment'># Borrar balizas lejanas (fuera del círculo) y caducadas.
</span>  <span class='id identifier rubyid_beacons'>beacons</span><span class='period'>.</span><span class='id identifier rubyid_delete_if'>delete_if</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_b'>b</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_b'>b</span><span class='period'>.</span><span class='id identifier rubyid_caducated?'>caducated?</span>
      <span class='id identifier rubyid_b'>b</span><span class='period'>.</span><span class='id identifier rubyid_remove'>remove</span><span class='lparen'>(</span><span class='rparen'>)</span>
      <span class='kw'>true</span>
    <span class='kw'>else</span>
      <span class='const'>Progrezz</span><span class='op'>::</span><span class='const'>Geolocation</span><span class='period'>.</span><span class='id identifier rubyid_distance'>distance</span><span class='lparen'>(</span><span class='id identifier rubyid_geolocation'>geolocation</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span><span class='period'>.</span><span class='id identifier rubyid_geolocation'>geolocation</span><span class='comma'>,</span> <span class='symbol'>:km</span><span class='rparen'>)</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_radius'>radius</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Retornar lista
</span>  <span class='kw'>return</span> <span class='id identifier rubyid_beacons'>beacons</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="action_radius-instance_method">
  
    - (<tt>Float</tt>) <strong>action_radius</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Radio de acción de la baliza, en km. Depende principalmente de su nivel.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Radio de acción de la baliza, en km.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


207
208
209</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rb/db/objects/beacon.rb', line 207</span>

<span class='kw'>def</span> <span class='id identifier rubyid_action_radius'>action_radius</span>
  <span class='const'>Game</span><span class='op'>::</span><span class='const'>Mechanics</span><span class='op'>::</span><span class='const'>BeaconMechanics</span><span class='period'>.</span><span class='id identifier rubyid__radius_per_level'>_radius_per_level</span><span class='lparen'>(</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_level_profile'>level_profile</span><span class='period'>.</span><span class='id identifier rubyid_level'>level</span> <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="add_life_time-instance_method">
  
    - (<tt>Float</tt>) <strong>add_life_time</strong>(time) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Añadir tiempo de vida a la baliza.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>time</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Tiempo de vida a añadir, especificado en minutos.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Tiempo añadido. Debería ser equivalente al parámetro <code>time</code>.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../GenericException.html" title="GenericException (class)">::GenericException</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


174
175
176
177
178
179
180</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rb/db/objects/beacon.rb', line 174</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_life_time'>add_life_time</span><span class='lparen'>(</span><span class='id identifier rubyid_time'>time</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='op'>::</span><span class='const'>GenericException</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid time value.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_time'>time</span> <span class='op'>==</span> <span class='kw'>nil</span> <span class='op'>||</span> <span class='id identifier rubyid_time'>time</span> <span class='op'>&lt;=</span> <span class='int'>0</span>

  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span> <span class='label'>duration:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_duration'>duration</span> <span class='op'>+</span> <span class='id identifier rubyid_time'>time</span> <span class='rparen'>)</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_time'>time</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="both-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Game::Database::Beacon (class)">Game::Database::Beacon</a></span></tt>) <strong>both</strong>(:connected_beacons) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Relación con otras balizas (triangulizables). Se puede acceder con el
atributo <code>connected_beacons</code>.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Game::Database::Beacon (class)">Game::Database::Beacon</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Balizas relacionadas.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


63</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rb/db/objects/beacon.rb', line 63</span>

<span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:both</span><span class='comma'>,</span> <span class='symbol'>:connected_beacons</span><span class='comma'>,</span> <span class='label'>model_class:</span> <span class='const'>Game</span><span class='op'>::</span><span class='const'>Database</span><span class='op'>::</span><span class='const'>Beacon</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>connected_to</span><span class='tstring_end'>&quot;</span></span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="check_neighbours-instance_method">
  
    - (<tt>Object</tt>) <strong>check_neighbours</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Comprobar estado de vecinos. Comprueba si los vecinos están muertos, y los
borra en tal caso.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


270
271
272</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rb/db/objects/beacon.rb', line 270</span>

<span class='kw'>def</span> <span class='id identifier rubyid_check_neighbours'>check_neighbours</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_neighbours'>neighbours</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_b'>b</span><span class='op'>|</span> <span class='id identifier rubyid_b'>b</span><span class='period'>.</span><span class='id identifier rubyid_remove'>remove</span><span class='lparen'>(</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_b'>b</span><span class='period'>.</span><span class='id identifier rubyid_caducated?'>caducated?</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="disconnect-instance_method">
  
    - (<tt>Object</tt>) <strong>disconnect</strong>(beacon) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Desconectarse de una baliza.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>beacon</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Game::Database::Beacon (class)">Game::Database::Beacon</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Baliza a desconectar.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../GenericException.html" title="GenericException (class)">::GenericException</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


293
294
295
296</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rb/db/objects/beacon.rb', line 293</span>

<span class='kw'>def</span> <span class='id identifier rubyid_disconnect'>disconnect</span><span class='lparen'>(</span><span class='id identifier rubyid_beacon'>beacon</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='op'>::</span><span class='const'>GenericException</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid beacon.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_beacon'>beacon</span> <span class='op'>==</span> <span class='kw'>nil</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_neighbours'>neighbours</span><span class='lparen'>(</span><span class='symbol'>:b</span><span class='comma'>,</span> <span class='symbol'>:rel</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_match_to'>match_to</span><span class='lparen'>(</span><span class='id identifier rubyid_beacon'>beacon</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_delete_all'>delete_all</span><span class='lparen'>(</span><span class='symbol'>:rel</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="dispatch-instance_method">
  
    - (<tt>Object</tt>) <strong>dispatch</strong>(event_name, *args) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Lanzar un evento desde la baliza actual.</p>

<p>Lista de eventos registrados:</p>
<ul><li>
<p><tt>:OnCreate (beacon)</tt>: Al crear la baliza.</p>
</li><li>
<p><tt>:OnLevelUp (beacon, new_level)</tt>: Al subir de nivel.</p>
</li><li>
<p><tt>:OnRemove (breaco)</tt>: Al borrar la baliza.</p>
</li></ul>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>event_name</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Nombre del evento a lanzar.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>args</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Argumentos a pasar a los callbacks (además de <code>self</code>).</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


390
391
392</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rb/db/objects/beacon.rb', line 390</span>

<span class='kw'>def</span> <span class='id identifier rubyid_dispatch'>dispatch</span><span class='lparen'>(</span><span class='id identifier rubyid_event_name'>event_name</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_dispatch_event'>dispatch_event</span><span class='lparen'>(</span><span class='id identifier rubyid_event_name'>event_name</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="energy_gained-instance_method">
  
    - (<tt>Integer</tt>) <strong>energy_gained</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Cantidad de energía que ha recibido la baliza.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Cantidad de energía.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


44</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rb/db/objects/beacon.rb', line 44</span>

<span class='id identifier rubyid_property'>property</span> <span class='symbol'>:energy_gained</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='int'>0</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="mark_as_removed-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Boolean.html" title="Boolean (module)">Boolean</a></span></tt>) <strong>mark_as_removed</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Variable auxiliar para evitar bucles infinitos.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Boolean.html" title="Boolean (module)">Boolean</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>false si no está marcada para borrar. true en caso contrario.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


48</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rb/db/objects/beacon.rb', line 48</span>

<span class='id identifier rubyid_property'>property</span> <span class='symbol'>:mark_as_removed</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>Boolean</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='kw'>false</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="max_connections-instance_method">
  
    - (<tt>Integer</tt>) <strong>max_connections</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Máximo número de conexiones de esta baliza.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Máximo número de conexiones de esta baliza.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


213
214
215</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rb/db/objects/beacon.rb', line 213</span>

<span class='kw'>def</span> <span class='id identifier rubyid_max_connections'>max_connections</span>
  <span class='kw'>return</span> <span class='const'>Game</span><span class='op'>::</span><span class='const'>Mechanics</span><span class='op'>::</span><span class='const'>BeaconMechanics</span><span class='period'>.</span><span class='id identifier rubyid_max_connections'>max_connections</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="message-instance_method">
  
    - (<tt>String</tt>) <strong>message</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Mensaje del usuario que ha dejado la baliza.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Contenido del mensaje.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


40</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rb/db/objects/beacon.rb', line 40</span>

<span class='id identifier rubyid_property'>property</span> <span class='symbol'>:message</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='const'>String</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='const'>DEFAULT_MESSAGE</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="out-instance_method">
  
    - (<tt><span class='object_link'><a href="LevelProfile.html" title="Game::Database::LevelProfile (class)">Game::Database::LevelProfile</a></span></tt>) <strong>out</strong>(:level_profile) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Relación con el nivel de la baliza (#Game::Database::LevelProfile). Se
puede acceder con el atributo <code>level_profile</code>.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="LevelProfile.html" title="Game::Database::LevelProfile (class)">Game::Database::LevelProfile</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Nivel de la baliza.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


57</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rb/db/objects/beacon.rb', line 57</span>

<span class='id identifier rubyid_has_one'>has_one</span> <span class='symbol'>:out</span><span class='comma'>,</span> <span class='symbol'>:level_profile</span><span class='comma'>,</span> <span class='label'>model_class:</span> <span class='const'>Game</span><span class='op'>::</span><span class='const'>Database</span><span class='op'>::</span><span class='const'>LevelProfile</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>profiles_in</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>dependent:</span> <span class='symbol'>:destroy</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="remove-instance_method">
  
    - (<tt>Object</tt>) <strong>remove</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Borrar baliza.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


183
184
185
186
187
188
189
190
191
192
193
194
195</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rb/db/objects/beacon.rb', line 183</span>

<span class='kw'>def</span> <span class='id identifier rubyid_remove'>remove</span><span class='lparen'>(</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_mark_as_removed'>mark_as_removed</span> <span class='op'>==</span> <span class='kw'>true</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='label'>mark_as_removed:</span> <span class='kw'>true</span><span class='rparen'>)</span>

  <span class='comment'># Lanzar evento
</span>  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_dispatch'>dispatch</span><span class='lparen'>(</span><span class='symbol'>:OnRemove</span><span class='rparen'>)</span>

  <span class='comment'># Exportar el nodo
</span>  <span class='const'>Game</span><span class='op'>::</span><span class='const'>Database</span><span class='op'>::</span><span class='const'>DatabaseManager</span><span class='period'>.</span><span class='id identifier rubyid_export_neo4jnode'>export_neo4jnode</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_rels'>rels</span><span class='rparen'>)</span>

  <span class='comment'># Destruir nodo
</span>  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span><span class='lparen'>(</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="to_hash-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span>&lt;Symbol, Object&gt;</tt>) <strong>to_hash</strong>(exclusion_list = [:owner]) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Transformar objeto a un hash</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>exclusion_list</span>
      
      
        <span class='type'>(<tt>Array&lt;Symbol&gt;</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>[:owner]</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Elementos a omitir en el hash de resultado.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span>&lt;Symbol, Object&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Objeto como hash.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rb/db/objects/beacon.rb', line 301</span>

<span class='kw'>def</span> <span class='id identifier rubyid_to_hash'>to_hash</span><span class='lparen'>(</span><span class='id identifier rubyid_exclusion_list'>exclusion_list</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='symbol'>:owner</span><span class='rbracket'>]</span> <span class='rparen'>)</span>
  <span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>

  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_exclusion_list'>exclusion_list</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='symbol'>:beacon</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_output'>output</span><span class='lbracket'>[</span><span class='symbol'>:info</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span>
     <span class='label'>uuid:</span>        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='comma'>,</span>
     <span class='label'>message:</span>     <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='comma'>,</span>
     <span class='label'>deploy_date:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_created_at'>created_at</span><span class='period'>.</span><span class='id identifier rubyid_strftime'>strftime</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%Q</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='comma'>,</span>
     <span class='label'>duration:</span>    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_duration'>duration</span>
    <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_exclusion_list'>exclusion_list</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='symbol'>:stats</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_lp'>lp</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_level_profile'>level_profile</span>
    <span class='id identifier rubyid_output'>output</span><span class='lbracket'>[</span><span class='symbol'>:stats</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span>
      <span class='label'>level:</span>              <span class='id identifier rubyid_lp'>lp</span><span class='period'>.</span><span class='id identifier rubyid_level'>level</span><span class='comma'>,</span>
      <span class='label'>level_exp:</span>          <span class='id identifier rubyid_lp'>lp</span><span class='period'>.</span><span class='id identifier rubyid_level_exp'>level_exp</span><span class='comma'>,</span>
      <span class='label'>exp_to_next_level:</span>  <span class='const'>Game</span><span class='op'>::</span><span class='const'>Mechanics</span><span class='op'>::</span><span class='const'>BeaconMechanics</span><span class='period'>.</span><span class='id identifier rubyid_exp_to_next_level'>exp_to_next_level</span><span class='lparen'>(</span><span class='id identifier rubyid_lp'>lp</span><span class='period'>.</span><span class='id identifier rubyid_level'>level</span> <span class='op'>+</span> <span class='int'>1</span><span class='rparen'>)</span><span class='comma'>,</span>
      <span class='label'>energy_gained:</span>      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_energy_gained'>energy_gained</span><span class='comma'>,</span>
      <span class='label'>action_radius:</span>      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_action_radius'>action_radius</span><span class='comma'>,</span>
      <span class='label'>weight_per_deposit:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_weight_per_deposit'>weight_per_deposit</span>
    <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_exclusion_list'>exclusion_list</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='symbol'>:neighbours</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_output'>output</span><span class='lbracket'>[</span><span class='symbol'>:neighbours</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_neighbours'>neighbours</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_b'>b</span><span class='op'>|</span> <span class='id identifier rubyid_output'>output</span><span class='lbracket'>[</span><span class='symbol'>:neighbours</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_b'>b</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_exclusion_list'>exclusion_list</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='symbol'>:owner</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_output'>output</span><span class='lbracket'>[</span><span class='symbol'>:owner</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_alias'>alias</span> <span class='kw'>if</span> <span class='id identifier rubyid_owner'>owner</span> <span class='op'>!=</span> <span class='kw'>nil</span> <span class='op'>||</span> <span class='id identifier rubyid_owner'>owner</span><span class='period'>.</span><span class='id identifier rubyid_alias'>alias</span> <span class='op'>!=</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_output'>output</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_neighbours-instance_method">
  
    - (<tt>Object</tt>) <strong>update_neighbours</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Actualizar conexiones con balizas cercanas.</p>
<ol><li>
<p>Primero, se buscará las balizas en el máximo radio de conexión.</p>
</li><li>
<p>Se ordenarán por distancia a la baliza actual.</p>
</li><li>
<p>Para cada baliza, se comprobará si está lo suficientemente cerca.</p>
</li><li>
<p>De ser así, se connectará con la nueva baliza.</p>
</li><li>
<p>Se repetirán los pasos 3 y 4 hasta que se agoten las balizas o se llegue al
máximo número de conexiones.</p>
</li></ol>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rb/db/objects/beacon.rb', line 224</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_neighbours'>update_neighbours</span><span class='lparen'>(</span><span class='rparen'>)</span>
  <span class='comment'># Comprobar si la baliza está muerta
</span>  <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_caducated?'>caducated?</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_remove'>remove</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_max_radius'>max_radius</span>      <span class='op'>=</span> <span class='const'>Game</span><span class='op'>::</span><span class='const'>Mechanics</span><span class='op'>::</span><span class='const'>BeaconMechanics</span><span class='period'>.</span><span class='id identifier rubyid__radius_per_level'>_radius_per_level</span><span class='lparen'>(</span> <span class='const'>Game</span><span class='op'>::</span><span class='const'>Mechanics</span><span class='op'>::</span><span class='const'>BeaconMechanics</span><span class='period'>.</span><span class='id identifier rubyid_max_level'>max_level</span> <span class='rparen'>)</span>
  <span class='id identifier rubyid_radius'>radius</span>          <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_action_radius'>action_radius</span>

  <span class='comment'># Comprobar si ha muerto alguna baliza vecina
</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_check_neighbours'>check_neighbours</span>

  <span class='comment'># Comprobar si ya ha suficientes balizas
</span>  <span class='id identifier rubyid_neighbours_count'>neighbours_count</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_neighbours'>neighbours</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_neighbours_count'>neighbours_count</span> <span class='op'>&gt;=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_max_connections'>max_connections</span>

  <span class='id identifier rubyid_geo'>geo</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_geolocation'>geolocation</span>

  <span class='comment'># Si no, buscar balizas cercanas
</span>  <span class='id identifier rubyid_beacons'>beacons</span> <span class='op'>=</span> <span class='const'>Game</span><span class='op'>::</span><span class='const'>Database</span><span class='op'>::</span><span class='const'>Beacon</span><span class='period'>.</span><span class='id identifier rubyid_search_by_radius'>search_by_radius</span><span class='lparen'>(</span> <span class='id identifier rubyid_geo'>geo</span><span class='comma'>,</span> <span class='id identifier rubyid_max_radius'>max_radius</span> <span class='rparen'>)</span>

  <span class='comment'># Eliminarse a sí mismo
</span>  <span class='id identifier rubyid_beacons'>beacons</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>

  <span class='comment'># Ordenarlas por cercanía a la posición
</span>  <span class='id identifier rubyid_beacons'>beacons</span><span class='period'>.</span><span class='id identifier rubyid_sort!'>sort!</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span><span class='op'>|</span> <span class='const'>Progrezz</span><span class='op'>::</span><span class='const'>Geolocation</span><span class='period'>.</span><span class='id identifier rubyid_distance'>distance</span><span class='lparen'>(</span><span class='id identifier rubyid_geo'>geo</span><span class='comma'>,</span> <span class='id identifier rubyid_a'>a</span><span class='rparen'>)</span> <span class='op'>&lt;=&gt;</span> <span class='const'>Progrezz</span><span class='op'>::</span><span class='const'>Geolocation</span><span class='period'>.</span><span class='id identifier rubyid_distance'>distance</span><span class='lparen'>(</span><span class='id identifier rubyid_geo'>geo</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span> <span class='rbrace'>}</span>

  <span class='comment'># Para cada una, intentar asociarla si está lo suficientemente cerca
</span>  <span class='id identifier rubyid_beacons'>beacons</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_b'>b</span><span class='op'>|</span>
    <span class='comment'># Seleccionar el radio más grande
</span>    <span class='id identifier rubyid_current_radius'>current_radius</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_radius'>radius</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_b'>b</span><span class='period'>.</span><span class='id identifier rubyid_action_radius'>action_radius</span><span class='rparen'>)</span><span class='op'>?</span> <span class='id identifier rubyid_radius'>radius</span> <span class='op'>:</span> <span class='id identifier rubyid_b'>b</span><span class='period'>.</span><span class='id identifier rubyid_action_radius'>action_radius</span>

    <span class='comment'># Si está cerca, conectar e intentar salir
</span>    <span class='kw'>if</span> <span class='const'>Progrezz</span><span class='op'>::</span><span class='const'>Geolocation</span><span class='period'>.</span><span class='id identifier rubyid_distance'>distance</span><span class='lparen'>(</span> <span class='id identifier rubyid_geo'>geo</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span><span class='period'>.</span><span class='id identifier rubyid_geolocation'>geolocation</span><span class='comma'>,</span> <span class='symbol'>:km</span> <span class='rparen'>)</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_current_radius'>current_radius</span>
      <span class='id identifier rubyid_neighbours_count'>neighbours_count</span> <span class='op'>+=</span> <span class='int'>1</span> <span class='kw'>if</span> <span class='id identifier rubyid_connect_to'>connect_to</span><span class='lparen'>(</span><span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span>

      <span class='comment'># Salir si ya hay suficientes conexiones
</span>      <span class='kw'>break</span> <span class='kw'>if</span> <span class='id identifier rubyid_neighbours_count'>neighbours_count</span> <span class='op'>&gt;=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_max_connections'>max_connections</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="weight_per_deposit-instance_method">
  
    - (<tt>Float</tt>) <strong>weight_per_deposit</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Peso (o probabilidad) Añadida a balizas cercanas. Depende principalmente de
su nivel.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Valor del peso a añadir.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


200
201
202</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rb/db/objects/beacon.rb', line 200</span>

<span class='kw'>def</span> <span class='id identifier rubyid_weight_per_deposit'>weight_per_deposit</span>
  <span class='const'>Game</span><span class='op'>::</span><span class='const'>Mechanics</span><span class='op'>::</span><span class='const'>BeaconMechanics</span><span class='period'>.</span><span class='id identifier rubyid__weight_per_level'>_weight_per_level</span><span class='lparen'>(</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_level_profile'>level_profile</span><span class='period'>.</span><span class='id identifier rubyid_level'>level</span> <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Fri May 22 14:15:09 2015 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.2.0).
</div>

  </body>
</html>
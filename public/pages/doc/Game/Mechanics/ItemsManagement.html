<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Game::Mechanics::ItemsManagement
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!Game/Mechanics/ItemsManagement.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (I)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Game.html" title="Game (module)">Game</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Mechanics.html" title="Game::Mechanics (module)">Mechanics</a></span></span>
     &raquo; 
    <span class="title">ItemsManagement</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Game::Mechanics::ItemsManagement
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Game::Mechanics::ItemsManagement</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">rb/game/mechanics/items.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Clase gestora de las mecánicas de juego referente a los objetos del juego
(recursos, básicamente).</p>


  </div>
</div>
<div class="tags">
  

</div>
  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="DEPOSIT_REPLICATION_PER_RADIUS_KM-constant" class="">DEPOSIT_REPLICATION_PER_RADIUS_KM =
          <div class="docstring">
  <div class="discussion">
    
<p>Cantidad de fragmentos a generar por kilómetro cuadrado</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>4</span></pre></dd>
      
        <dt id="DEPOSIT_MIN_COUNT-constant" class="">DEPOSIT_MIN_COUNT =
          <div class="docstring">
  <div class="discussion">
    
<p>Número mínimo de depósitos en la zona para empezar a generar más.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>2</span></pre></dd>
      
        <dt id="DATAFILE-constant" class="">DATAFILE =
          <div class="docstring">
  <div class="discussion">
    
<p>Datos referentes a este gestor.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>data/items.json</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
        <dt id="items-classvariable" class="">@@items =
          <div class="docstring">
  <div class="discussion">
    
<p>Lista de objetos (guardado por si hace falta usarlo).</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='kw'>nil</span></pre></dd>
      
    </dl>
  







  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_item-class_method" title="find_item (class method)">+ (Hash<sup>?</sup>) <strong>find_item</strong>(item_id) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Getter de un objeto (más rápido que buscarlo en la base de datos).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#generate_nearby_deposits-class_method" title="generate_nearby_deposits (class method)">+ (Integer) <strong>generate_nearby_deposits</strong>(user, deposits_output) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Generar depósitos cercanos al usuario.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#init_items-class_method" title="init_items (class method)">+ (Object) <strong>init_items</strong>(content = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Inicializar objetos del juego (cargando desde un json).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#setup-class_method" title="setup (class method)">+ (Object) <strong>setup</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Inicializar gestor de mecánicas de objetos.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="find_item-class_method">
  
    + (<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span></tt><sup>?</sup>) <strong>find_item</strong>(item_id) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Getter de un objeto (más rápido que buscarlo en la base de datos).</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>item_id</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Identificador del objeto.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Información del objeto. Si no encuentra nada, retornará <code>nil</code>.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


90
91
92</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rb/game/mechanics/items.rb', line 90</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_find_item'>find_item</span><span class='lparen'>(</span><span class='id identifier rubyid_item_id'>item_id</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='cvar'>@@items</span><span class='lbracket'>[</span><span class='id identifier rubyid_item_id'>item_id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_deep_clone'>deep_clone</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="generate_nearby_deposits-class_method">
  
    + (<tt>Integer</tt>) <strong>generate_nearby_deposits</strong>(user, deposits_output) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Generar depósitos cercanos al usuario.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>user</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Database/User.html" title="Game::Database::User (class)">Game::Database::User</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Referencia a un usuario.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>deposits_output</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span>&lt;Symbol, Object&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Depósitos cercanos a <code>user</code>.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Número de depósitos generados.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rb/game/mechanics/items.rb', line 98</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_generate_nearby_deposits'>generate_nearby_deposits</span><span class='lparen'>(</span><span class='id identifier rubyid_user'>user</span><span class='comma'>,</span> <span class='id identifier rubyid_deposits_output'>deposits_output</span><span class='rparen'>)</span>
  <span class='comment'># El radio se obtiene directamente del usuario
</span>  <span class='id identifier rubyid_radius'>radius</span> <span class='op'>=</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_get_current_search_radius'>get_current_search_radius</span><span class='lparen'>(</span><span class='symbol'>:deposits</span><span class='rparen'>)</span>
  
  <span class='comment'># Depósitos cercanos al jugador
</span>  <span class='id identifier rubyid_deposits_count'>deposits_count</span> <span class='op'>=</span> <span class='id identifier rubyid_deposits_output'>deposits_output</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
  
  <span class='comment'># Salir si ya hay suficientes depósitos.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_deposits_count'>deposits_count</span> <span class='op'>&gt;=</span> <span class='const'>DEPOSIT_MIN_COUNT</span>
    <span class='kw'>return</span>
  <span class='kw'>end</span>
  
  <span class='comment'># Cantidad máxima de depósitos a generar
</span>  <span class='id identifier rubyid_max_deposits'>max_deposits</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_radius'>radius</span> <span class='op'>*</span> <span class='const'>DEPOSIT_REPLICATION_PER_RADIUS_KM</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_round'>round</span>
  
  <span class='comment'># Preparar selector de objetos según su peso.
</span>  <span class='id identifier rubyid_ponderation'>ponderation</span> <span class='op'>=</span> <span class='cvar'>@@deposit_list</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span> <span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_weight'>weight</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_deposit_picker'>deposit_picker</span> <span class='op'>=</span> <span class='const'>Pickup</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_ponderation'>ponderation</span><span class='rparen'>)</span>
  
  <span class='comment'># TODO: Aumentar probabilidad de generación si hay balizas cercanas
</span>  <span class='comment'># ...
</span>  
  <span class='id identifier rubyid_user_geo'>user_geo</span> <span class='op'>=</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_geolocation'>geolocation</span>

  <span class='comment'># Empezar a generar
</span>  <span class='const'>Game</span><span class='op'>::</span><span class='const'>Database</span><span class='op'>::</span><span class='const'>DatabaseManager</span><span class='period'>.</span><span class='id identifier rubyid_run_nested_transaction'>run_nested_transaction</span> <span class='kw'>do</span>
    <span class='kw'>while</span> <span class='id identifier rubyid_deposits_count'>deposits_count</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_max_deposits'>max_deposits</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_random_geolocation'>random_geolocation</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='label'>latitude:</span> <span class='int'>0</span><span class='comma'>,</span> <span class='label'>longitude:</span> <span class='int'>0</span><span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_random_geolocation'>random_geolocation</span> <span class='op'>==</span> <span class='kw'>nil</span>
      
      <span class='comment'># Generar offsets a partir del radio
</span>      <span class='id identifier rubyid_random_geolocation'>random_geolocation</span><span class='lbracket'>[</span><span class='symbol'>:latitude</span><span class='rbracket'>]</span>  <span class='op'>=</span> <span class='id identifier rubyid_user_geo'>user_geo</span><span class='lbracket'>[</span><span class='symbol'>:latitude</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='const'>Progrezz</span><span class='op'>::</span><span class='const'>Geolocation</span><span class='period'>.</span><span class='id identifier rubyid_distance_to_latitude'>distance_to_latitude</span><span class='lparen'>(</span>  <span class='id identifier rubyid_radius'>radius</span><span class='comma'>,</span> <span class='symbol'>:km</span> <span class='rparen'>)</span>
      <span class='id identifier rubyid_random_geolocation'>random_geolocation</span><span class='lbracket'>[</span><span class='symbol'>:longitude</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_user_geo'>user_geo</span><span class='lbracket'>[</span><span class='symbol'>:longitude</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='const'>Progrezz</span><span class='op'>::</span><span class='const'>Geolocation</span><span class='period'>.</span><span class='id identifier rubyid_distance_to_longitude'>distance_to_longitude</span><span class='lparen'>(</span> <span class='id identifier rubyid_radius'>radius</span><span class='comma'>,</span> <span class='symbol'>:km</span> <span class='rparen'>)</span>
      
      <span class='comment'># Elegir un depósito aleatoriamente según su peso y replicarlo
</span>      <span class='id identifier rubyid_new_instance'>new_instance</span> <span class='op'>=</span> <span class='cvar'>@@deposit_list</span><span class='lbracket'>[</span><span class='id identifier rubyid_deposit_picker'>deposit_picker</span><span class='period'>.</span><span class='id identifier rubyid_pick'>pick</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_instantiate'>instantiate</span><span class='lparen'>(</span> <span class='id identifier rubyid_random_geolocation'>random_geolocation</span> <span class='rparen'>)</span>
      
      <span class='comment'># Añadir a la salida
</span>      <span class='id identifier rubyid_deposits_output'>deposits_output</span><span class='lbracket'>[</span><span class='id identifier rubyid_new_instance'>new_instance</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_new_instance'>new_instance</span>
      
      <span class='comment'># Incrementar número de depósitos generados
</span>      <span class='id identifier rubyid_deposits_count'>deposits_count</span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  
  <span class='kw'>return</span> <span class='id identifier rubyid_deposits_count'>deposits_count</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="init_items-class_method">
  
    + (<tt>Object</tt>) <strong>init_items</strong>(content = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Inicializar objetos del juego (cargando desde un json).</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../GenericException.html" title="GenericException (class)">::GenericException</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rb/game/mechanics/items.rb', line 29</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_init_items'>init_items</span><span class='lparen'>(</span><span class='id identifier rubyid_content'>content</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='comment'># Leer de fichero
</span>  <span class='kw'>begin</span>
    <span class='cvar'>@@items</span> <span class='op'>=</span> <span class='const'>JSON</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span> <span class='id identifier rubyid_content'>content</span> <span class='op'>||</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='const'>DATAFILE</span><span class='rparen'>)</span> <span class='rparen'>)</span>
    <span class='const'>GenericUtils</span><span class='period'>.</span><span class='id identifier rubyid_symbolize_keys_deep!'>symbolize_keys_deep!</span><span class='lparen'>(</span><span class='cvar'>@@items</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='op'>::</span><span class='const'>GenericException</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error while parsing item list from &#39;</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_content'>content</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&#39;: </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='id identifier rubyid_e'>e</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  
  <span class='comment'># Para cada objeto
</span>  <span class='id identifier rubyid_item_id_list'>item_id_list</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='cvar'>@@items</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='id identifier rubyid_item_id_list'>item_id_list</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_i'>i</span><span class='lbracket'>[</span><span class='symbol'>:item_id</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_item'>item</span> <span class='op'>=</span> <span class='const'>Game</span><span class='op'>::</span><span class='const'>Database</span><span class='op'>::</span><span class='const'>Item</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span> <span class='label'>item_id:</span> <span class='id identifier rubyid_i'>i</span><span class='lbracket'>[</span><span class='symbol'>:item_id</span><span class='rbracket'>]</span> <span class='rparen'>)</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_item'>item</span> <span class='op'>==</span> <span class='kw'>nil</span>
      <span class='comment'># Si no existe, añadir a la base de datos.
</span>      <span class='id identifier rubyid_item'>item</span> <span class='op'>=</span> <span class='const'>Game</span><span class='op'>::</span><span class='const'>Database</span><span class='op'>::</span><span class='const'>Item</span><span class='period'>.</span><span class='id identifier rubyid_create_item'>create_item</span><span class='lparen'>(</span> <span class='id identifier rubyid_i'>i</span> <span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='comment'># Si ya existe, actualizar todo
</span>      <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_update_item'>update_item</span><span class='lparen'>(</span> <span class='id identifier rubyid_i'>i</span> <span class='rparen'>)</span>
    <span class='kw'>end</span>
    
    <span class='comment'># Realizar gestión de depósitos
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_i'>i</span><span class='lbracket'>[</span><span class='symbol'>:deposit</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='kw'>nil</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_i'>i</span><span class='lbracket'>[</span><span class='symbol'>:deposit</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='comment'># Si se especifica, actualizar.
</span>      
      <span class='kw'>if</span> <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_deposit'>deposit</span> <span class='op'>!=</span> <span class='kw'>nil</span>
        <span class='comment'># Si existe, actualizarlo
</span>        <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_deposit'>deposit</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span> <span class='id identifier rubyid_i'>i</span><span class='lbracket'>[</span><span class='symbol'>:deposit</span><span class='rbracket'>]</span> <span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='comment'># Si no, crearlo
</span>        <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_create_deposit'>create_deposit</span><span class='lparen'>(</span> <span class='id identifier rubyid_i'>i</span><span class='lbracket'>[</span><span class='symbol'>:deposit</span><span class='rbracket'>]</span> <span class='rparen'>)</span>
      <span class='kw'>end</span>
      
    <span class='kw'>else</span>
      <span class='comment'># Si no, borrar de la base de datos.
</span>      <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_deposit'>deposit</span><span class='period'>.</span><span class='id identifier rubyid_remove'>remove</span><span class='lparen'>(</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_deposit'>deposit</span> <span class='op'>!=</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>
    
  <span class='kw'>end</span>
  
  <span class='comment'># Destruir los objetos que no esten en la base de datos.
</span>  <span class='const'>Game</span><span class='op'>::</span><span class='const'>Database</span><span class='op'>::</span><span class='const'>Item</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_item'>item</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_item_id_list'>item_id_list</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_item_id'>item_id</span>
      <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_remove'>remove</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  
  <span class='comment'># Preparar lista de objetos (referencias)
</span>  <span class='cvar'>@@deposit_list</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='const'>Game</span><span class='op'>::</span><span class='const'>Database</span><span class='op'>::</span><span class='const'>ItemDeposit</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span> <span class='cvar'>@@deposit_list</span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_item_id'>item_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_id'>id</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='op'>::</span><span class='const'>GenericException</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>There are no deposits in the database to intantiate.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='cvar'>@@deposit_list</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  
  <span class='comment'># Preparar lista de objetos (acceso rápido)
</span>  <span class='cvar'>@@items</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='lbracket'>[</span><span class='cvar'>@@items</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='lbracket'>[</span><span class='symbol'>:item_id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span> <span class='rbracket'>]</span> <span class='rbrace'>}</span> <span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="setup-class_method">
  
    + (<tt>Object</tt>) <strong>setup</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Inicializar gestor de mecánicas de objetos.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


24
25
26</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'rb/game/mechanics/items.rb', line 24</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_setup'>setup</span><span class='lparen'>(</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_init_items'>init_items</span><span class='lparen'>(</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Tue Apr 14 12:18:50 2015 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.2.0).
</div>

  </body>
</html>
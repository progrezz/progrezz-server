task :default => ["development:start"]

desc 'Setup everything.'
task :setup do
  # Install bundle
  begin
    sh 'gem install bundle'
  rescue
    puts "Error while installing bundle."
  end

  # Install gems
  begin
    sh 'bundle install'
  rescue
    puts "Error while installing gems."
  end

  puts "Use '$ rake' to start with development!"

end

namespace :neo4j do
  desc 'Start the Neo4j Server'
  task :start do
    sh 'neo4j start'
  end

  desc 'Stop the Neo4j Server'
  task :stop do
    sh 'neo4j stop'
  end
end

namespace :development do
  desc 'Quick dev start'
  task :start do
    begin
      sh 'neo4j start'
    rescue
    end
    sh 'rackup'
  end

  desc 'Start a racksh console for console debuggin.'
  task :sh do
    begin
      sh 'neo4j start'
    rescue
    end
    sh 'racksh'
  end
end

namespace :production do
  desc 'Start the server'
  task :start do
    sh 'bundle exec rackup -E production'
  end

  desc 'Start the server (network test)'
  task :start_net do
    sh 'ruby main.rb -o 0.0.0.0' # Â¿?
  end
end

namespace :heroku do
  desc 'Setup heroku toolbelt.'
  task :setup do
    sh "wget -qO- https://toolbelt.heroku.com/install-ubuntu.sh | sh"
  end

  desc 'Launch the server to an heroku app.'
  task :start do
    sh 'git push heroku HEAD:master --force'
  end

  desc 'Log heroku data and errors.'
  task :logs do
    sh 'heroku logs'
  end

end
